<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Longboard Ranking</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: #0a0a0a;
            color: #ffffff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #1a1a1a;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #333;
            white-space: nowrap;
        }

        th {
            background: #2d2d2d;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }

        th:hover {
            background: #3d3d3d;
        }

        th::after {
            content: '↕';
            position: absolute;
            right: 8px;
            opacity: 0.6;
            font-size: 0.8em;
        }

        tr:hover {
            background: #252525;
        }

        .rank {
            color: #4a90e2;
            font-weight: bold;
        }

        .total-points {
            color: #00d474;
            font-weight: bold;
        }

        .sort-asc::after {
            content: ' ↑';
            color: #4a90e2;
        }

        .sort-desc::after {
            content: ' ↓';
            color: #4a90e2;
        }
    </style>
</head>
<body>
    <div class="container">
        <table id="rankingTable">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Birthday</th>
                    <th>Region</th>
                    <th>Best Place</th>
                    <th>2017</th>
                    <th>2018</th>
                    <th>2019</th>
                    <th>2021</th>
                    <th>2022</th>
                    <th>2023</th>
                    <th>2024</th>
                    <th>Total Points</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentSortColumn = null;
            let isAscending = true;
            let tableData = [];

            // Load and parse CSV
            fetch('../ranking/longboard_men.csv')
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').slice(1);
                    tableData = rows.map(row => {
                        const cells = row.split(',');
                        return {
                            rank: parseInt(cells[0]),
                            name: cells[1],
                            birthday: cells[2],
                            region: cells[3],
                            bestPlace: parseInt(cells[5]),
                            y2017: parseInt(cells[6]),
                            y2018: parseInt(cells[7]),
                            y2019: parseInt(cells[8]),
                            y2021: parseInt(cells[9]),
                            y2022: parseInt(cells[10]),
                            y2023: parseInt(cells[11]),
                            y2024: parseInt(cells[12]),
                            total: parseInt(cells[13])
                        };
                    });
                    renderTable(tableData);
                });

            // Render table
            function renderTable(data) {
                const tbody = document.querySelector('#rankingTable tbody');
                tbody.innerHTML = '';
                
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="rank">${item.rank}</td>
                        <td>${item.name}</td>
                        <td>${item.birthday}</td>
                        <td>${item.region}</td>
                        <td>${item.bestPlace}</td>
                        <td>${item.y2017 || '-'}</td>
                        <td>${item.y2018 || '-'}</td>
                        <td>${item.y2019 || '-'}</td>
                        <td>${item.y2021 || '-'}</td>
                        <td>${item.y2022 || '-'}</td>
                        <td>${item.y2023 || '-'}</td>
                        <td>${item.y2024 || '-'}</td>
                        <td class="total-points">${item.total}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Sorting functionality
            document.querySelectorAll('th').forEach((th, index) => {
                th.addEventListener('click', () => {
                    const column = getColumnKey(index);
                    
                    if(currentSortColumn === column) {
                        isAscending = !isAscending;
                    } else {
                        isAscending = true;
                        currentSortColumn = column;
                    }

                    // Update sorting indicators
                    document.querySelectorAll('th').forEach(th => {
                        th.classList.remove('sort-asc', 'sort-desc');
                    });
                    th.classList.add(isAscending ? 'sort-asc' : 'sort-desc');

                    // Sort data
                    tableData.sort((a, b) => {
                        if(typeof a[column] === 'string') {
                            return isAscending 
                                ? a[column].localeCompare(b[column]) 
                                : b[column].localeCompare(a[column]);
                        }
                        return isAscending 
                            ? a[column] - b[column] 
                            : b[column] - a[column];
                    });

                    renderTable(tableData);
                });
            });

            function getColumnKey(index) {
                const columns = [
                    'rank', 'name', 'birthday', 'region', 'bestPlace',
                    'y2017', 'y2018', 'y2019', 'y2021', 'y2022',
                    'y2023', 'y2024', 'total'
                ];
                return columns[index];
            }
        });
    </script>
</body>
</html>